    Checking oc-token-optim v0.1.0 (C:\Users\czhu6\gh\MOON)
warning: function `truncate_with_ellipsis` is never used
  --> src\moon\util.rs:14:8
   |
14 | pub fn truncate_with_ellipsis(input: &str, max_chars: usize) -> String {
   |        ^^^^^^^^^^^^^^^^^^^^^^
   |
   = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: use of `or_insert_with` to construct default value
   --> src\moon\archive.rs:237:58
    |
237 |             let list = tool_sections.entry(tool.clone()).or_insert_with(Vec::new);
    |                                                          ^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_default()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#unwrap_or_default
    = note: `#[warn(clippy::unwrap_or_default)]` on by default

warning: use of `or_insert_with` to construct default value
   --> src\moon\archive.rs:243:72
    |
243 |             let list = tool_sections.entry("unknown_tool".to_string()).or_insert_with(Vec::new);
    |                                                                        ^^^^^^^^^^^^^^^^^^^^^^^^ help: try: `or_default()`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#unwrap_or_default

warning: calling `push_str()` using a single-character string literal
   --> src\moon\archive.rs:262:13
    |
262 |             out.push_str("\n");
    |             ^^^^^^^^^^^^^^^^^^ help: consider using `push` with a character literal: `out.push('\n')`
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#single_char_add_str
    = note: `#[warn(clippy::single_char_add_str)]` on by default

warning: this `if` statement can be collapsed
   --> src\moon\archive.rs:479:9
    |
479 | /         if !reproject {
480 | |             if let Some(existing_projection) = record
481 | |                 .projection_path
482 | |                 .as_deref()
...   |
493 | |         }
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_if
    = note: `#[warn(clippy::collapsible_if)]` on by default
help: collapse nested if block
    |
479 ~         if !reproject
480 ~             && let Some(existing_projection) = record
481 |                 .projection_path
...
491 |                 continue;
492 ~             }
    |

warning: this `if` statement can be collapsed
   --> src\moon\distill.rs:640:13
    |
640 | / ...   if part.get("type").and_then(Value::as_str) == Some("text") {
641 | | ...       if let Some(text) = part.get("text").and_then(Value::as_str) {
642 | | ...           if let Some(cleaned) = clean_candidate_text(text) {
643 | | ...               if cleaned.len() <= 1024 && !looks_like_json_blob(&cleaned) && !cleaned.contains("<<<EXTERNAL_UNTRUSTED_CONTENT>>>") {
...   |
648 | | ...   }
    | |_______^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_if
help: collapse nested if block
    |
640 ~             if part.get("type").and_then(Value::as_str) == Some("text")
641 ~                 && let Some(text) = part.get("text").and_then(Value::as_str) {
642 |                     if let Some(cleaned) = clean_candidate_text(text) {
...
646 |                     }
647 ~                 }
    |

warning: this `if` statement can be collapsed
   --> src\moon\distill.rs:641:17
    |
641 | / ...   if let Some(text) = part.get("text").and_then(Value::as_str) {
642 | | ...       if let Some(cleaned) = clean_candidate_text(text) {
643 | | ...           if cleaned.len() <= 1024 && !looks_like_json_blob(&cleaned) && !cleaned.contains("<<<EXTERNAL_UNTRUSTED_CONTENT>>>") {
644 | | ...               text_parts.push(cleaned);
...   |
647 | | ...   }
    | |_______^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_if
help: collapse nested if block
    |
641 ~                 if let Some(text) = part.get("text").and_then(Value::as_str)
642 ~                     && let Some(cleaned) = clean_candidate_text(text) {
643 |                         if cleaned.len() <= 1024 && !looks_like_json_blob(&cleaned) && !cleaned.contains("<<<EXTERNAL_UNTRUSTED_CONTENT>>>") {
644 |                             text_parts.push(cleaned);
645 |                         }
646 ~                     }
    |

warning: this `if` statement can be collapsed
   --> src\moon\distill.rs:642:21
    |
642 | / ...   if let Some(cleaned) = clean_candidate_text(text) {
643 | | ...       if cleaned.len() <= 1024 && !looks_like_json_blob(&cleaned) && !cleaned.contains("<<<EXTERNAL_UNTRUSTED_CONTENT>>>") {
644 | | ...           text_parts.push(cleaned);
645 | | ...       }
646 | | ...   }
    | |_______^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_if
help: collapse nested if block
    |
642 ~                     if let Some(cleaned) = clean_candidate_text(text)
643 ~                         && cleaned.len() <= 1024 && !looks_like_json_blob(&cleaned) && !cleaned.contains("<<<EXTERNAL_UNTRUSTED_CONTENT>>>") {
644 |                             text_parts.push(cleaned);
645 ~                         }
    |

warning: this `if` statement can be collapsed
   --> src\moon\distill.rs:654:17
    |
654 | /                 if let Some(text) = part.get("text").and_then(Value::as_str) {
655 | |                     if let Some(cleaned) = clean_candidate_text(text) {
656 | |                         text_parts.push(cleaned);
657 | |                     }
658 | |                 }
    | |_________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_if
help: collapse nested if block
    |
654 ~                 if let Some(text) = part.get("text").and_then(Value::as_str)
655 ~                     && let Some(cleaned) = clean_candidate_text(text) {
656 |                         text_parts.push(cleaned);
657 ~                     }
    |

warning: this `if` statement can be collapsed
   --> src\moon\distill.rs:659:20
    |
659 |               } else if part_type == "toolUse" {
    |  ____________________^
660 | |                 if let Some(name) = part.get("name").and_then(Value::as_str) {
661 | |                     tool_name = Some(name.to_string());
662 | |                     priority = Some(match name {
...   |
679 | |             }
    | |_____________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_if
help: collapse nested if block
    |
659 ~             } else if part_type == "toolUse"
660 ~                 && let Some(name) = part.get("name").and_then(Value::as_str) {
661 |                     tool_name = Some(name.to_string());
...
677 |                     }
678 ~                 }
    |

warning: this `else { if .. }` block can be collapsed
   --> src\moon\distill.rs:672:32
    |
672 |                           } else {
    |  ________________________________^
673 | |                             if let Ok(dump) = serde_json::to_string(input) {
674 | |                                 tool_target = Some(truncate_with_ellipsis(&dump, 64));
675 | |                             }
676 | |                         }
    | |_________________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_else_if
    = note: `#[warn(clippy::collapsible_else_if)]` on by default
help: collapse nested if block
    |
672 ~                         } else if let Ok(dump) = serde_json::to_string(input) {
673 +                             tool_target = Some(truncate_with_ellipsis(&dump, 64));
674 +                         }
    |

warning: this `else { if .. }` block can be collapsed
   --> src\moon\distill.rs:770:16
    |
770 |           } else {
    |  ________________^
771 | |             if !looks_like_json_blob(trimmed) && let Some(cleaned) = clean_candidate_text(trimmed) {
772 | |                 entries.push(ProjectionEntry {
773 | |                     timestamp_epoch: None,
...   |
782 | |         }
    | |_________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_else_if
help: collapse nested if block
    |
770 ~         } else if !looks_like_json_blob(trimmed) && let Some(cleaned) = clean_candidate_text(trimmed) {
771 +             entries.push(ProjectionEntry {
772 +                 timestamp_epoch: None,
773 +                 role: "system".to_string(),
774 +                 content: cleaned,
775 +                 tool_name: None,
776 +                 tool_target: None,
777 +                 priority: None,
778 +                 coupled_result: None,
779 +             });
780 +         }
    |

warning: this `if` statement can be collapsed
   --> src\moon\distill.rs:762:24
    |
762 |                   } else if entry.role == "toolResult" {
    |  ________________________^
763 | |                     if let Some(use_idx) = pending_tool_uses.pop() {
764 | |                         entries[use_idx].coupled_result = Some(entry.content.clone());
765 | |                     }
766 | |                 }
    | |_________________^
    |
    = help: for further information visit https://rust-lang.github.io/rust-clippy/rust-1.92.0/index.html#collapsible_if
help: collapse nested if block
    |
762 ~                 } else if entry.role == "toolResult"
763 ~                     && let Some(use_idx) = pending_tool_uses.pop() {
764 |                         entries[use_idx].coupled_result = Some(entry.content.clone());
765 ~                     }
    |

warning: `oc-token-optim` (bin "MOON") generated 13 warnings (run `cargo clippy --fix --bin "MOON" -p oc-token-optim` to apply 12 suggestions)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.44s
